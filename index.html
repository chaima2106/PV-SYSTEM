<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Système IoT PV - Données en Temps Réel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
    }
    .logo {
      height: 60px;
    }
    .data-card {
      border-radius: 1rem;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      background-color: white;
      padding: 20px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="text-center mb-4">
      <img src="https://upload.wikimedia.org/wikipedia/commons/3/3f/Solar_power_symbol.svg" alt="Logo PV" class="logo" />
      <h1 class="mt-2">Données IoT en Temps Réel</h1>
    </div>

    <div class="row justify-content-center">
      <div class="col-md-4 data-card text-center">
        🌡️ <strong>Température :</strong> <span id="temp">--</span> °C
      </div>
      <div class="col-md-4 data-card text-center">
        🔋 <strong>Tension :</strong> <span id="volt">--</span> V
      </div>
      <div class="col-md-4 data-card text-center">
        ⚡ <strong>Puissance :</strong> <span id="power">--</span> W
      </div>
    </div>

    <div class="mt-4 data-card">
      <h4 class="text-center">📈 Évolution de la température</h4>
      <canvas id="tempChart"></canvas>
    </div>
  </div>

  <script>
    const ctx = document.getElementById('tempChart').getContext('2d');
    const tempChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Température (°C)',
          data: [],
          borderColor: 'rgb(255, 99, 132)',
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          fill: true,
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: { title: { display: true, text: 'Temps' }},
          y: { beginAtZero: true, title: { display: true, text: '°C' }}
        }
      }
    });

    async function fetchData() {
      try {
        const response = await fetch('https://e4d7-105-101-43-93.ngrok-free.app/iot'); // remplace si besoin
        const data = await response.json();

        document.getElementById('temp').textContent = data.temperature;
        document.getElementById('volt').textContent = data.tension;
        document.getElementById('power').textContent = data.puissance;

        const time = new Date().toLocaleTimeString();
        tempChart.data.labels.push(time);
        tempChart.data.datasets[0].data.push(data.temperature);

        if (tempChart.data.labels.length > 10) {
          tempChart.data.labels.shift();
          tempChart.data.datasets[0].data.shift();
        }

        tempChart.update();
      } catch (error) {
        console.error('Erreur lors de la récupération des données:', error);
      }
    }

    setInterval(fetchData, 5000);
    fetchData();
  </script>
</body>
</html>
